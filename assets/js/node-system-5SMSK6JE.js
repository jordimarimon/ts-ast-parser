import{a as p,b as _,c as C,d as F}from"./chunk-JGZNYISH.js";import{a as m,c as v,d as x}from"./chunk-X5OQPEMW.js";var n=v(x(),1);import*as s from"path";import*as u from"fs";var g=class{constructor(e){let{analyserOptions:t,vfs:o,fsMap:d}=e;if(o){this._sys=C(d??new Map),this._commandLine=this._createCommandLine(t,e);let i=s.dirname(m.resolve("typescript"));u.readdirSync(i).filter(a=>a.startsWith("lib.")&&a.endsWith(".d.ts")).forEach(a=>{this._sys.writeFile(`/${a}`,u.readFileSync(s.join(i,a),"utf-8"))}),this._host=F(this._sys,this._commandLine.options,n.default).compilerHost}else this._sys=n.default.sys,this._commandLine=this._createCommandLine(t,e),this._host=n.default.createCompilerHost(this._commandLine.options,!0)}getSystem(){return this._sys}getCompilerHost(){return this._host}getCommandLine(){return this._commandLine}getCurrentDirectory(){return this._host.getCurrentDirectory()}fileExists(e){return this._host.fileExists(e)}readFile(e){return this._host.readFile(e)??""}writeFile(e,t){this._host.writeFile(e,t,!1)}normalizePath(e){return e?s.normalize(s.relative(this.getCurrentDirectory(),e)):""}getAbsolutePath(e){return e?s.isAbsolute(e)?e:s.resolve(e):""}_createCommandLine(e,t){let{compilerOptions:o,jsProject:d,include:i,exclude:r}=e;if(d)return n.default.parseJsonConfigFileContent({compilerOptions:_,include:i??["**/*.js"],exclude:r??["**node_modules**"]},this._sys,t.vfs?"/":process.cwd());if(o)return n.default.parseJsonConfigFileContent({compilerOptions:{...o,declaration:!0},include:i??["**/*.ts"],exclude:r??["**node_modules**"]},this._sys,t.vfs?"/":process.cwd());let c=this._parseTSConfigFile(e,t);return c||n.default.parseJsonConfigFileContent({compilerOptions:p,include:i??["**/*.ts"],exclude:r??["**node_modules**"]},this._sys,t.vfs?"/":process.cwd())}_parseTSConfigFile(e,t){var o,d;let{tsConfigFilePath:i,include:r,exclude:c}=e,a=h=>n.default.sys.fileExists(h),y=h=>n.default.sys.readFile(h),L=i?s.isAbsolute(i)?s.dirname(i):s.dirname(s.join(process.cwd(),i)):process.cwd(),b=i?s.basename(i):"tsconfig.json",f=n.default.findConfigFile(L,a,b),l=f&&n.default.readConfigFile(f,y);return!l||typeof l!="object"?null:(c!==void 0&&Array.isArray(c)&&((o=l.config).exclude??(o.exclude=[]),l.config.exclude.push(...c)),r!==void 0&&Array.isArray(r)&&((d=l.config).include??(d.include=[]),l.config.include.push(...r)),n.default.parseJsonConfigFileContent(l.config,this._sys,t.vfs?"/":s.dirname(f),{},t.vfs?void 0:f))}};export{g as NodeSystem};
