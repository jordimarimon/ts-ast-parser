import{a as _,b as g,c as F,d as C}from"./chunk-JGZNYISH.js";import{a as f,c as b,d as S}from"./chunk-X5OQPEMW.js";var n=b(S(),1);import*as t from"path";import*as d from"fs";var y=class{constructor(e={}){if(this._options={},this._updateFile=null,this._options=e,e.vfs){this._sys=F(e.fsMap??new Map),this._commandLine=this._createCommandLine();let o=t.dirname(f.resolve("typescript"));d.readdirSync(o).filter(i=>i.startsWith("lib.")&&i.endsWith(".d.ts")).forEach(i=>{this._sys.writeFile(`/${i}`,d.readFileSync(t.join(o,i),"utf-8"))});let s=C(this._sys,this._commandLine.options,n.default);this._host=s.compilerHost,this._updateFile=s.updateFile}else this._sys=n.default.sys,this._commandLine=this._createCommandLine(),this._host=n.default.createCompilerHost(this._commandLine.options,!0)}getSystem(){return this._sys}getCompilerHost(){return this._host}getCommandLine(){return this._commandLine}getCurrentDirectory(){return this._host.getCurrentDirectory()}fileExists(e){return this._host.fileExists(e)}readFile(e){return this._host.readFile(e)??""}writeFile(e,o){let a=this._host.fileExists(e);if(this._options.vfs&&a){let c=this._commandLine.options.target??n.default.ScriptTarget.ES2022,s=this._host.getSourceFile(e,c),i={span:{start:0,length:s.text.length},newLength:o.length},r=s.update(o,i);this._updateFile?.(r)}else this._host.writeFile(e,o,!1);a||(this._commandLine=this._createCommandLine())}normalizePath(e){return e?t.normalize(t.relative(this.getCurrentDirectory(),e)):""}getAbsolutePath(e){return e?t.isAbsolute(e)?e:this._options.vfs?t.join(this.getCurrentDirectory(),e):t.resolve(e):""}getDirName(e){return t.dirname(e)}join(...e){return t.join(...e)}_createCommandLine(){let{analyserOptions:e={},vfs:o}=this._options,{compilerOptions:a,jsProject:c,include:s,exclude:i}=e,r=["**node_modules**"],h=o?"/":process.cwd();if(c)return n.default.parseJsonConfigFileContent({compilerOptions:g,include:s??["**/*.js"],exclude:i??r},this._sys,h);if(a)return n.default.parseJsonConfigFileContent({compilerOptions:{...a,declaration:!0},include:s??["**/*.ts"],exclude:i??r},this._sys,h);let p=this._parseTSConfigFile();return p||n.default.parseJsonConfigFileContent({compilerOptions:_,include:s??["**/*.ts"],exclude:i??r},this._sys,h)}_parseTSConfigFile(){var e,o;let{analyserOptions:a={},vfs:c}=this._options,{tsConfigFilePath:s,include:i,exclude:r}=a,h=m=>n.default.sys.fileExists(m),p=m=>n.default.sys.readFile(m),L=s?t.isAbsolute(s)?t.dirname(s):t.dirname(t.join(process.cwd(),s)):process.cwd(),x=s?t.basename(s):"tsconfig.json",u=n.default.findConfigFile(L,h,x),l=u&&n.default.readConfigFile(u,p);return!l||typeof l!="object"?null:(r!==void 0&&Array.isArray(r)&&((e=l.config).exclude??(e.exclude=[]),l.config.exclude.push(...r)),i!==void 0&&Array.isArray(i)&&((o=l.config).include??(o.include=[]),l.config.include.push(...i)),n.default.parseJsonConfigFileContent(l.config,this._sys,c?"/":t.dirname(u),{},c?void 0:u))}};export{y as NodeSystem};
