import{a as P,b as f}from"./chunk-ZQUVYYHX.js";import{c as F}from"./chunk-BLPUKQJE.js";var m=["lib.d.ts","lib.decorators.d.ts","lib.decorators.legacy.d.ts","lib.dom.d.ts","lib.dom.iterable.d.ts","lib.es2015.collection.d.ts","lib.es2015.core.d.ts","lib.es2015.d.ts","lib.es2015.generator.d.ts","lib.es2015.iterable.d.ts","lib.es2015.promise.d.ts","lib.es2015.proxy.d.ts","lib.es2015.reflect.d.ts","lib.es2015.symbol.d.ts","lib.es2015.symbol.wellknown.d.ts","lib.es2016.array.include.d.ts","lib.es2016.d.ts","lib.es2016.full.d.ts","lib.es2017.d.ts","lib.es2017.full.d.ts","lib.es2017.intl.d.ts","lib.es2017.object.d.ts","lib.es2017.sharedmemory.d.ts","lib.es2017.string.d.ts","lib.es2017.typedarrays.d.ts","lib.es2018.asyncgenerator.d.ts","lib.es2018.asynciterable.d.ts","lib.es2018.d.ts","lib.es2018.full.d.ts","lib.es2018.intl.d.ts","lib.es2018.promise.d.ts","lib.es2018.regexp.d.ts","lib.es2019.array.d.ts","lib.es2019.d.ts","lib.es2019.full.d.ts","lib.es2019.intl.d.ts","lib.es2019.object.d.ts","lib.es2019.string.d.ts","lib.es2019.symbol.d.ts","lib.es2020.bigint.d.ts","lib.es2020.d.ts","lib.es2020.date.d.ts","lib.es2020.full.d.ts","lib.es2020.intl.d.ts","lib.es2020.number.d.ts","lib.es2020.promise.d.ts","lib.es2020.sharedmemory.d.ts","lib.es2020.string.d.ts","lib.es2020.symbol.wellknown.d.ts","lib.es2021.d.ts","lib.es2021.full.d.ts","lib.es2021.intl.d.ts","lib.es2021.promise.d.ts","lib.es2021.string.d.ts","lib.es2021.weakref.d.ts","lib.es2022.array.d.ts","lib.es2022.d.ts","lib.es2022.error.d.ts","lib.es2022.full.d.ts","lib.es2022.intl.d.ts","lib.es2022.object.d.ts","lib.es2022.regexp.d.ts","lib.es2022.sharedmemory.d.ts","lib.es2022.string.d.ts","lib.es2023.array.d.ts","lib.es2023.d.ts","lib.es2023.full.d.ts","lib.es5.d.ts","lib.es6.d.ts","lib.esnext.d.ts","lib.esnext.full.d.ts","lib.esnext.intl.d.ts","lib.scripthost.d.ts","lib.webworker.d.ts","lib.webworker.importscripts.d.ts","lib.webworker.iterable.d.ts"];var g=F(P(),1),b="root",l="/",r;(function(c){c[c.File=0]="File",c[c.Directory=1]="Directory"})(r||(r={}));var y=class c{constructor(e){this.newLine=`
`,this.useCaseSensitiveFileNames=!1,this.args=[],this._fs={type:r.Directory,name:b,children:[],parent:null};let s=e?.entries()??[];for(let[t,i]of s)this.writeFile(t,i)}static async create(e){let s=new c(e);return f?await s._writeLibFilesFromCDN(g.default.version):await s._writeLibFilesFromNodeModules(),s}write(e){throw new Error("Method 'write' is not supported.")}readFile(e){let s=this.getAbsolutePath(e),t=this._get(s);if(t?.type===r.File)return t.data}writeFile(e,s){let t=this.getAbsolutePath(e);this._setFile(t,s)}resolvePath(e){return this.getAbsolutePath(e)}fileExists(e){let s=this.getAbsolutePath(e);return this._get(s)?.type===r.File}directoryExists(e){let s=this.getAbsolutePath(e);return this._get(s)?.type===r.Directory}createDirectory(e){let s=this.getAbsolutePath(e);this._setDirectory(s)}getExecutingFilePath(){throw new Error("Method 'getExecutingFilePath' is not supported.")}getCurrentDirectory(){return b}getDirectories(e){let s=this.getAbsolutePath(e),t=this._get(s);return t?.type===r.Directory?t.children.filter(i=>i.type===r.Directory).map(i=>i.name):[]}readDirectory(e,s){let t=this.getAbsolutePath(e),i=this._get(t);if(!i||i.type===r.File)return[];let o=this._getPath(i),n=i.children.filter(d=>d.type===r.File).map(d=>this.join(o,d.name));return s?n.filter(d=>s.some(h=>d.endsWith(h))):n}deleteFile(e){let s=this.getAbsolutePath(e),t=this._get(s);if(!t)return;if(t.type===r.Directory)throw new Error(`Unable to delete the file "${s}" because it's a directory.`);let i=t.parent.children.findIndex(o=>o.name===t.name);i<-1||t.parent.children.splice(i,1)}exit(){throw new Error("Method 'exit' is not supported.")}normalizePath(e){return this.getAbsolutePath(e).split(l).slice(1).join(l)}getDirectoryName(e){return this.getAbsolutePath(e).split(l).slice(0,-1).join(l)}getBaseName(e){let s=this.getAbsolutePath(e),t=this._get(s);return!t||t.type===r.Directory?"":t.name}join(...e){return e.join(l)}isAbsolute(e){return e.startsWith(b)}realpath(e){return this.getAbsolutePath(e)}getAbsolutePath(e){let s=e.toLowerCase().split(l).filter(t=>!!t&&!/^\.+$/.test(t));return s[0]===b?s.join(l):[b,...s].join(l)}async _writeLibFilesFromNodeModules(){let e=await import("./get-lib-files-from-node-6YOSBL2E.js"),s=e.getLibFilesFromNode(),t=e.getTypesFromNode();for(let[i,o]of s.entries())this.writeFile(i,o);for(let[i,o]of t.entries())this.writeFile(i,o)}_writeLibFilesFromCDN(e){let s=`https://typescript.azureedge.net/cdn/${e}/typescript/lib/`,t=[];for(let i of m){let o=fetch(s+i).then(n=>n.text()).then(n=>this.writeFile(i,n)).catch(n=>console.error(n));t.push(o)}return Promise.all(t)}_get(e){let s=e.split(l).slice(1);if(!s.length)return this._fs;let t=this._fs;for(let i of s){if(!t)break;if(t.type===r.File){t=void 0;break}t=t.children.find(o=>o.name===i)}return t}_setFile(e,s){let t=e.split(l).slice(1),i=t.slice(0,-1),o=t[t.length-1]??"";if(!o)throw new Error(`Empty file name found when trying to write to: "${e}".`);let n=this._fs;for(let a of i){let u=n.children.find(w=>w.name===a);if(u?.type===r.File)throw new Error(`Expected a directory but found a file when trying to write to: "${e}".`);if(u?.type===r.Directory){n=u;continue}let p={type:r.Directory,name:a,children:[],parent:n};n.children.push(p),n=p}let d=n.children.find(a=>a.name===o&&a.type===r.File);if(d){d.data=s;return}let h={data:s,type:r.File,name:o,parent:n};n.children.push(h)}_setDirectory(e){let s=e.split(l).slice(1),t=this._fs;for(let i of s){let o=t.children.find(d=>d.name===i);if(o?.type===r.File)throw new Error(`Expected a directory but found a file when trying to write to: "${e}".`);if(o?.type===r.Directory){t=o;continue}let n={type:r.Directory,name:i,children:[],parent:t};t.children.push(n),t=n}}_getPath(e){let s=e,t=[];for(;s;)t.push(s.name),s=s.parent;return t.reverse().join(l)}};export{y as InMemorySystem};
